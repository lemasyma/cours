<!DOCTYPE html><html lang="fr-FR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="pv-proxy-endpoint" content="https://cours-v2.ew.r.appspot.com/query?id=agplfmNvdXJzLXYychULEghBcGlRdWVyeRiAgIDo14eBCgw"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="CCMP2 : Intermediate Representation" /><meta property="og:locale" content="fr_FR" /><meta name="description" content="Lien de la note Hackmd Cours du 27/04 Boulot qui reste a faire: Lineariser le programme Allocation des registres Gerer la pile" /><meta property="og:description" content="Lien de la note Hackmd Cours du 27/04 Boulot qui reste a faire: Lineariser le programme Allocation des registres Gerer la pile" /><link rel="canonical" href="https://lemasyma.github.io/cours/posts/ccmp2_intermediate-representation/" /><meta property="og:url" content="https://lemasyma.github.io/cours/posts/ccmp2_intermediate-representation/" /><meta property="og:site_name" content="Cours" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-27T11:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="CCMP2 : Intermediate Representation" /><meta name="google-site-verification" content="mErcVOJcxNzULHvQ99qSclI_DTX0zANqgpsd3jGhkfs" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-12-21T01:44:58+01:00","datePublished":"2020-04-27T11:00:00+02:00","description":"Lien de la note Hackmd Cours du 27/04 Boulot qui reste a faire: Lineariser le programme Allocation des registres Gerer la pile","headline":"CCMP2 : Intermediate Representation","mainEntityOfPage":{"@type":"WebPage","@id":"https://lemasyma.github.io/cours/posts/ccmp2_intermediate-representation/"},"url":"https://lemasyma.github.io/cours/posts/ccmp2_intermediate-representation/"}</script><title>CCMP2 : Intermediate Representation | Cours</title><link rel="apple-touch-icon" sizes="180x180" href="/cours/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/cours/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/cours/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/cours/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/cours/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Cours"><meta name="application-name" content="Cours"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/cours/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cours-v2.ew.r.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://cours-v2.ew.r.appspot.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/cours/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/cours/" alt="avatar" class="mx-auto"> <img src="/cours/assets/img/favicons/logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/cours/">Cours</a></div><div class="site-subtitle font-italic">Certains cours sont en francais, certains sont en anglais, d'autres sont un mix des deux</div></div><ul class="w-100"><li class="nav-item"> <a href="/cours/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/cours/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/cours/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/cours/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/cours/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/lemasyma" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="" aria-label="" target="_blank" rel="noopener"> <i class=""></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/cours/"> Home </a> </span> <span>CCMP2 : Intermediate Representation</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>CCMP2 : Intermediate Representation</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/lemasyma">lemasyma</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2020-04-27 11:00:00 +0200" data-toggle="tooltip" data-placement="bottom" title="Mon, Apr 27, 2020, 11:00 AM +0200" >Apr 27, 2020</em> </span> <span> Updated <em class="timeago" date="2021-12-21 01:44:58 +0100 " data-toggle="tooltip" data-placement="bottom" title="Tue, Dec 21, 2021, 1:44 AM +0100" >Dec 21, 2021</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1684 words"> <em>9 min</em> read</span> <span> <em id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </em> views </span></div></div></div><div class="post-content"><p>Lien de la <a href="https://hackmd.io/@lemasymasa/HJ06Js4yD">note Hackmd</a></p><h1 id="cours-du-2704">Cours du 27/04</h1><p>Boulot qui reste a faire:</p><ul><li>Lineariser le programme<li>Allocation des registres<li>Gerer la pile</ul><h2 id="compilers-structure">Compilers structure<a href="#compilers-structure"><i class="fas fa-hashtag"></i></a></h2></h2><p>Ends:</p><ul><li><em>front end</em>: analysis<ul><li>lexical analysis (scanning)<li>synctactic analysis (parsing)<li>ast generation<li>static semantice analysis (type checking)<li>source language specific optimizations<li>hir generation</ul><li><em>middle end</em>: generic synthesis<ul><li>optimisations generiques</ul><li><em>back end</em>: specific synthesis<ul><li>register allocation</ul></ul><p>The gcc team suggests:</p><ul><li><em>front-end</em> name (“a front end”)<li><em>front-end</em> adjective (“the front-end interface”)</ul><h2 id="retargetable-compilers">Retargetable Compilers<a href="#retargetable-compilers"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-proofer-ignore data-src="https://i.imgur.com/8V0vB0i.png" alt="" /> Si on veut generer du ARM a partir du JAVA, le trait rpz un compilateur complet. On rajoute un compilateur de JAVA a MIPS, de JAVA a IA-32, etc. et ce pour tous les compilateurs en entree. Cette strategie n’est pas bonne car il y a beaucoup de compilateurs et de la duplication de code.</p><p>Supposons qu’on aie une representation intermediaire: <img data-proofer-ignore data-src="https://i.imgur.com/Jca3vYB.png" alt="" /> Il suffit plus d’un traducteur de la representation intermediaire vers ARM, MIPS, etc. On a plus que 4 traducteurs, on a transforme une multiplication en addition.</p><div class="alert alert-danger" role="alert"><p>Comment definir cette representation intermediaire?</p></div><p>On a besoin d’une representation flexible pour pouvoir etre la cible des langages de hauts niveaux mais assez assembleur pour etre traduit en assembleur.</p><ol><li>Le front-end “tire” le langage intermediaire vers lui<li>Le back-end “tire” la representation intermediaire pour etre le plus proche possible du langage assembleur<h3 id="premiere-idee-baricentre">Premiere idee: baricentre<a href="#premiere-idee-baricentre"><i class="fas fa-hashtag"></i></a></h3></h3></ol><div class="alert alert-info" role="alert"><p>Affecter un poids aux langages en entree et ceux en sortie: avoir un <strong>baricentre</strong></p></div><p>Si tout le mone a un poids de 1, le langage intermediaire sera plutot front-end, sinon plutot backend.</p><div class="alert alert-warning" role="alert"><p>Comment calculer le baricentre de tous mes langages ?</p></div><p>On fait l’instersection de toutes les fonctionnalites des langages.</p><div class="alert alert-danger" role="alert"><p>Qu’est-ce qui se passe le jour ou on rajoute un nouveau langage? <strong>Le baricentre va bouger</strong>.</p></div><h3 id="seconde-idee">Seconde idee<a href="#seconde-idee"><i class="fas fa-hashtag"></i></a></h3></h3><p>Deux langages intermediaires: un pour le front-end, un pour le back-end <img data-proofer-ignore data-src="https://i.imgur.com/OAxScQO.png" alt="" /> Traduction de Java a 1 c’est facile, de 1 a 2 difficile. On aura plein de petits traducteurs simples et un gros traducteur complique, on a seulement 10 traducteurs.</p><p>On rajoute deux nouveaux langages intermediaires: <img data-proofer-ignore data-src="https://i.imgur.com/aYOptRX.png" alt="" /> La traduction de 1 vers 3 et de 4 vers 2 est moins dure que de 1 vers 2.</p><div class="alert alert-danger" role="alert"><p>On est en train de <strong>reconstruire</strong> une multiplicite de traducteurs.</p></div><h3 id="idee-finale">Idee finale<a href="#idee-finale"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>couche: <em>j’enleve la partie objet</em><li>couche: enlever le support des fonctions variadique<li>couche: transformer les for en while<li>couche: enlever une autre fonctionnalite<li>etc.</ol><p><img data-proofer-ignore data-src="https://i.imgur.com/zyZF2FX.png" alt="" /></p><p>C’est le <strong>desucrage</strong>. Dans notre langage intermediaire on veut desucrer notre langage en entier.</p><div class="alert alert-danger" role="alert"><p>Comment definir tous ces langages intermediaires?</p></div><p>Syntax, grammaire, type-checker, etc. Deux solutions:</p><ol><li>Nouveau parser/lexer mais pas coherent<li>On va definir des langages intermediaires mais on va jamais ecrire de parser<ul><li>on va definir une grammaire<li>on va traduire l’AST de notre langage original en AST du langage choisir</ul></ol><h3 id="other-compiling-strategies">Other Compiling Strategies<a href="#other-compiling-strategies"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>Intermediate language-based strategies: SmartEiffel, GHC<li>Bytecode strategy: Java bytecode (JVM), CIL (.NET)<li>Hybrid approaches: GCJ (Java bytecode or native code)<li>Retargetable optimizing back ends: MLRISC, VPO (Very Portbale Optimizer), and <em>somehow</em> C– (Quick C–)<li>Modular systems: LLVM (compiler as a library, centered on a typed IR). Contains the LLVM core libraries, Clang, LLDB, etc. Also:<ul><li>VMKit: a substrate for virtual machines (JVM, etc.)<li>Emscripten: an LLVM-to-JavaScript compiler. Enables C/C++ to JS compilation</ul></ul><div class="alert alert-danger" role="alert"><p>Intermediate Representations (IR) are fundamental.</p></div><h2 id="intermediate-representations">Intermediate representations<a href="#intermediate-representations"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="format-representation-language">Format? Representation? Language?<a href="#format-representation-language"><i class="fas fa-hashtag"></i></a></h3></h3><p><em>Intermediate representation:</em></p><ul><li>a faithful model of the source program<li>“written” in an abstract language, the <strong>intermediate language</strong><li>may have an external syntax<li>may be interpreted/compiled (havm, byte code)<li>may have different levels (gcc’s Tree is very much like C)</ul><h3 id="what-language-flavor-">What language flavor ?<a href="#what-language-flavor-"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>imperative?<ul><li>Stack based?<li>Register based?</ul><li>Functional?<ul><li>Most function languages are compiled into a lower lever language, eventually a simple $\lambda$-calculus.</ul><li>Other?</ul><h3 id="what-level">What level?<a href="#what-level"><i class="fas fa-hashtag"></i></a></h3></h3><p>A whole range of expressivities, typically aiming at making some optimizations easier:</p><ul><li>Keep array expressions?<ul><li><strong>Yes</strong>: adequate for dependency analysis and related optimizations<li><strong>No</strong>: Good for constant folding, strength reduction, loop invariant, code motion, etc.</ul><li>Keep loop construcs?</ul><div class="alert alert-danger" role="alert"><p>What level of machine independence?</p><ul><li>Explicit register names?</ul></div><p>On doit construire notre langage en essayant d’etre le plus proche possible du code assembleur tout en etant suffisemment abstrait pour pas faire rentrer le nom des registres</p><h3 id="designing-an-intermediate-representation">Designing an Intermediate Representation<a href="#designing-an-intermediate-representation"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p>Intermediate-language design is largely an art, not a science. Muchnink, 1997</p></blockquote><pre><code class="language-cpp=">float a[20][10]
...
a[i][j+2]
</code></pre><p>Traduction dans les langages intermediaires:</p><pre><code class="language-go=">t1 &lt;- a[i, j+2]
</code></pre><div class="alert alert-info" role="alert"><p>On va avoir besoin de <strong>temporaires</strong> pour noter les resultats intermediaires.</p></div><pre><code class="language-go=">t1 &lt;- j + 2
t2 &lt;- i * 20
t3 &lt;- t1 + t2
t4 &lt;- 4 * t3
t5 &lt;- addr a
t6 &lt;- t5 + t4
t7 &lt;- *t6
</code></pre><p>On a une approche progressive plus agreable qu’une approche directe.</p><pre><code class="language-go=">r1 &lt;- [fp - 4]
r2 &lt;- r1 + 2
r3 &lt;- [fp - 8]
r4 &lt;- r3 * 20
r5 &lt;- r4 + r2
r6 &lt;- 4 * r5
r7 &lt;- fp - 216
f1 &lt;- [r7 + r6]
</code></pre><p>Sans la traduction precedente, il est impossible de comprendre comment cette traduction fonctionne.</p><h3 id="gcc">GCC<a href="#gcc"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-proofer-ignore data-src="https://i.imgur.com/fjm3kTD.png" alt="" /></p><h3 id="stack-based-java-byte-code">Stack Based: Java Byte-Code<a href="#stack-based-java-byte-code"><i class="fas fa-hashtag"></i></a></h3></h3><pre><code class="language-java=">class Gcd {
    static public int gcd(int a, int b) {
        while (a != b) {
            if ( a &gt; b)
                a -= b;
            else
                b -= a;
        }
        return a;
    }
    
    static public int main(String[] arg) {
        return gcd(12, 34)
    }
}

</code></pre><p><img data-proofer-ignore data-src="https://i.imgur.com/G8trZai.png" alt="" /></p><h3 id="stack-based-edwards-2003">Stack Based (Edwards, 2003)<a href="#stack-based-edwards-2003"><i class="fas fa-hashtag"></i></a></h3></h3><p>Advantages</p><ul><li>Trivial translation of expressions<li>Trivial interpreters<li>No pressure on registers<li>Often compact</ul><p>Disadvantages</p><ul><li>Does not fit with today’s architecture<li>Hard to analyze<li>Hard to optimize</ul><h3 id="register-based-tcs-tree">Register Based <em>tc</em>’s Tree<a href="#register-based-tcs-tree"><i class="fas fa-hashtag"></i></a></h3></h3><div class="alert alert-info" role="alert"><p>Une representation sous forme de registre est fatalement <strong>plus verbeux</strong>.</p></div><p>Du a:</p><ul><li>La pile<li>L’epilogue<li>Le prologue</ul><p>Chaque fonction utilise un certain nombre de registres, il y a beaucoup de travails supplementaires pour maintenir la coherence des registres.</p><h3 id="register-based-what-structure-">Register Based: What structure ?<a href="#register-based-what-structure-"><i class="fas fa-hashtag"></i></a></h3></h3><p>How is the structure coded ?</p><ul><li><strong>Addresses</strong><ul><li>Expressions and instructions have names or (absolute) addresses. (Stack based is a bit like relative address)<ul><li>2 address instructions ? (<em>triples</em>)<li>3 addresses instructions ? (<em>quadruples</em>)</ul></ul></ul><p>Quadruples vs Triples:</p><pre><code class="language-go=">i &lt;- i + 1

t1 &lt;- i + 1
t2 &lt;-  p + 4
t3 &lt;- *t2
p &lt;- t2
t4 &lt;- t1 &lt; 10
*r &lt;- t3
if t4 goto L1
</code></pre><pre><code class="language-go=">(1) i + 1
(2) i sto (1)
(3) i + 1
(4) p + 4
(5) *(4)
(6) p sto (4)
(7) (3) &lt; 10
(8) *r sto (5) 
(9) if (7), (1)
</code></pre><p>On note le resultat de chaque ligne dans (nb). Autant ne pas prendre cette strategie et prendre une proche des microprocesserus actuels.</p><h3 id="register-based-edwards-2003">Register Based (Edwards, 2003)<a href="#register-based-edwards-2003"><i class="fas fa-hashtag"></i></a></h3></h3><p>Advantages:</p><ul><li>Suit today’s architecture<li>Clearer data flow</ul><p>Disadvantages</p><ul><li>Harder to synthesize<li>Less compact<li>Harder to interpret</ul><h2 id="tree">Tree<a href="#tree"><i class="fas fa-hashtag"></i></a></h2></h2><p>On a besoin d’un langage intermediaire qui nous sert de support pour le reste du cours</p><h3 id="grammar">Grammar<a href="#grammar"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-proofer-ignore data-src="https://i.imgur.com/jBq9xdN.png" alt="" /></p><h3 id="tree-sample">Tree sample<a href="#tree-sample"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-proofer-ignore data-src="https://i.imgur.com/d4zSAYb.png" alt="" /></p><h1 id="memory-management">Memory management</h1><p>On en train de faire remonter les infos du microprocesseur au langage intermediaire, on doit gerer le minimum possible de la memoire pour rester abstrait</p><h2 id="memory-hierarchy">Memory Hierarchy<a href="#memory-hierarchy"><i class="fas fa-hashtag"></i></a></h2></h2><p>Different kinds of memory in a computer, with different performances:</p><ul><li><strong>Registers</strong> Small memory units built on the CPU<li><strong>L1 Cache</strong> Last main memory acces results<li><strong>L2 Cache</strong> (MB, 10 cycles)<li><strong>Memory</strong> The usual ram (GB, 100 cycles)<li><strong>Storage</strong> Disks (100GB)</ul><p>Use the registers as much as possible</p><h3 id="register-overflow">Register Overflow<a href="#register-overflow"><i class="fas fa-hashtag"></i></a></h3></h3><div class="alert alert-info" role="alert"><p>Si notre langage a pas la recursion, on n’a pas de pile a gerer.</p></div><p>What if there are not enough registers ? Use the main memory, but how? Recursion:</p><ul><li><strong>Without:</strong> Each name is bound once. It can be statically allocated a single unit of main memory (Cobol, Concurrent Pascal, Frotran)\<li><strong>With:</strong> a single name can be part of several concurrent bindings. Memory allocation must be dynamic</ul><h3 id="dynamic-memory-allocation">Dynamic Memory Allocation<a href="#dynamic-memory-allocation"><i class="fas fa-hashtag"></i></a></h3></h3><p>Depending on the persistence, several models:</p><ul><li>Global: global object whose liveness is equal to that of the program, are statically allocated<li>Automatic: liveness is bound to that of the host function<li>Heap: Liveness is indenpendant of function liveness<ul><li>User controlled: malloc/free<li>Garbage collected</ul><li>Stack <img data-proofer-ignore data-src="https://i.imgur.com/fdJuAyu.png" alt="" /></ul><h2 id="activation-blocks">Activation Blocks<a href="#activation-blocks"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>In recursive languages, a single routine can be “opened” several times concurrently<li>An <em>activation</em> designates one single instance of execution<li>Automatic variables are bound to the liveness of the activation<li>Their location is naturally called <em>activation block</em> or <em>stack frame</em></ul><h3 id="activation-blocks-contents">Activation Blocks Contents<a href="#activation-blocks-contents"><i class="fas fa-hashtag"></i></a></h3></h3><p>Data to store on the stack:</p><ul><li>arguments: incoming<li>local varibales: user automatic variables<li>return address: where to return<li>saved registers: the caller’s environment to restore<li>temp: compiler automatic variables, spills<li>static link: when needed</ul><h3 id="activation-blocks-layout">Activation Blocks Layout<a href="#activation-blocks-layout"><i class="fas fa-hashtag"></i></a></h3></h3><p>Est-ce qu’on peut mettre le content dans l’ordre que je veux ?</p><div class="alert alert-info" role="alert"><p>On doit decider d’un layout respecte par tous les compilateurs.</p></div><p>The layout is suggested by the constructor. <img data-proofer-ignore data-src="https://i.imgur.com/Z3s32f7.png" alt="" /></p><div class="alert alert-danger" role="alert"><ul><li><strong>fp</strong>: frame pointer<li><strong>sp</strong>: stack pointer</ul></div><p>Au milieu de ces 2 pointers on a notre block d’activation. Lors d’un appel de fonction, on descend <strong>fp</strong> sur <strong>sp</strong> puis on descend <strong>sp</strong>. On doit etre capable de stocker l’ancienne valeur de <strong>fp</strong>.</p><h3 id="flexible-automatic-memory">Flexible Automatic Memory<a href="#flexible-automatic-memory"><i class="fas fa-hashtag"></i></a></h3></h3><p><em>auto</em>: Static size, automatic memory <em>malloc</em>: Dynamic size, persistent memory Automatic memeory is extremely convenient</p><pre><code class="language-c=">int
open2(char* str1, char* str2, int flags, int mode){
    char name[strlen(str1) + strlen(str2) + 1];
    strcpy(strcpy(name, str1), str2);
    return open(name, flags, mode)
}
</code></pre><p>On est en train de faire un <strong>tableau dynamique</strong>.</p><p>On est sur une variable locale stockee sur la pile, cad stockee sur le bloc d’activation. On doit etre capable de preallouer la zone necessaire. Hors ici on dit que la taille de la zone depend des parametres au runtime et ne sera pas connu lors de la compilation.</p><p>Pour une meme fonction f, on peut avoir des blocs d’activation de taille variable. Au moment ou on rentre dans la fonction on doit pousser le stack pointer vers le bas avec <strong>alloca</strong>:</p><pre><code class="language-c=">int
open2(char* str1, char* str2, int flags, int mode){
    char *name = (char *) alloca(strlen(str1) + strlen(str2) + 1);
    strcpy(strcpy(name, str1), str2);
    return open(name, flags, mode)
</code></pre><h3 id="advantages-of-alloca">Advantages of alloca<a href="#advantages-of-alloca"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>Using alloca wastes very little space and is very fast<li>On peut simuler alloca</ul><h2 id="nonlocal-variables">Nonlocal variables<a href="#nonlocal-variables"><i class="fas fa-hashtag"></i></a></h2></h2><div class="alert alert-info" role="alert"><p>Une variable est consideree comme une variable non locale si elle est declaree dans une fonction englobante et utilisee dans une autre fonction imbriquee.</p></div><h3 id="escapes-n-recursion">escapes-n-recursion<a href="#escapes-n-recursion"><i class="fas fa-hashtag"></i></a></h3></h3><pre><code class="language-ocaml=">let function trace(fn: string, val: int) =
    (print(fn); print("("); print_int(val); print(")"))
    
    function one(input : int) =
    let function two() =
        (trace("two", input); one(input - 1))
    in
        if input &gt; 0 then
            (two(); trace("one", input))
    end
in
    one(3); print("\n")
end
</code></pre><p>Resultat de l’execution: <img data-proofer-ignore data-src="https://i.imgur.com/xBIh9yO.png" alt="" /> <img data-proofer-ignore data-src="https://i.imgur.com/tAO1Kxr.png" alt="" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/cours/categories/s6/'>S6</a>, <a href='/cours/categories/tronc-commun/'>tronc commun</a>, <a href='/cours/categories/ccmp2/'>CCMP2</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/cours/tags/s6/" class="post-tag no-text-decoration" >S6</a> <a href="/cours/tags/ccmp2/" class="post-tag no-text-decoration" >CCMP2</a> <a href="/cours/tags/tronc-commun/" class="post-tag no-text-decoration" >tronc commun</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=CCMP2 : Intermediate Representation - Cours&url=https://lemasyma.github.io/cours/posts/ccmp2_intermediate-representation/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=CCMP2 : Intermediate Representation - Cours&u=https://lemasyma.github.io/cours/posts/ccmp2_intermediate-representation/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=CCMP2 : Intermediate Representation - Cours&url=https://lemasyma.github.io/cours/posts/ccmp2_intermediate-representation/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/cours/posts/ocvx_norme/">OCVX: Norme</a><li><a href="/cours/posts/imed2_tp3/">IMED2: TP3</a><li><a href="/cours/posts/prsta_revisions_1/">PRSTA: Revisions 1</a><li><a href="/cours/posts/prsta_td5/">PRSTA: TD 5</a><li><a href="/cours/posts/prsta_td4/">PRSTA: TD 4</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/cours/tags/image/">Image</a> <a class="post-tag" href="/cours/tags/s8/">S8</a> <a class="post-tag" href="/cours/tags/s9/">S9</a> <a class="post-tag" href="/cours/tags/tronc-commun/">tronc commun</a> <a class="post-tag" href="/cours/tags/scia/">SCIA</a> <a class="post-tag" href="/cours/tags/s6/">S6</a> <a class="post-tag" href="/cours/tags/shannon/">Shannon</a> <a class="post-tag" href="/cours/tags/cama/">CAMA</a> <a class="post-tag" href="/cours/tags/loi/">loi</a> <a class="post-tag" href="/cours/tags/rvau/">RVAU</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/cours/posts/ccmp2_revisions/"><div class="card-body"> <em class="timeago small" date="2020-07-02 11:00:00 +0200" >Jul 2, 2020</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CCMP2 : Seance de revisions</h3><div class="text-muted small"><p> Lien de la note Hackmd Revisions CCMP2 Middle End Traduction vers le langage Tree Lineariser le code etape de linearisation: casser l’arborescence faire remonter les expressi...</p></div></div></a></div><div class="card"> <a href="/cours/posts/sede_intro/"><div class="card-body"> <em class="timeago small" date="2020-02-11 11:00:00 +0100" >Feb 11, 2020</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SEDE : Introduction</h3><div class="text-muted small"><p></p></div></div></a></div><div class="card"> <a href="/cours/posts/sede_buffer_overflow/"><div class="card-body"> <em class="timeago small" date="2020-02-25 11:00:00 +0100" >Feb 25, 2020</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SEDE : Buffer overflow and better API's</h3><div class="text-muted small"><p></p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/cours/posts/ma12-methode-iterative/" class="btn btn-outline-primary" prompt="Older"><p>CAMA : ma12 Méthodes itératives</p></a> <a href="/cours/posts/socra-clean-code/" class="btn btn-outline-primary" prompt="Newer"><p>SOCRA : Cours du 30 avril</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/lemasyma">lemasyma</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/cours/tags/image/">Image</a> <a class="post-tag" href="/cours/tags/s8/">S8</a> <a class="post-tag" href="/cours/tags/s9/">S9</a> <a class="post-tag" href="/cours/tags/tronc-commun/">tronc commun</a> <a class="post-tag" href="/cours/tags/scia/">SCIA</a> <a class="post-tag" href="/cours/tags/s6/">S6</a> <a class="post-tag" href="/cours/tags/shannon/">Shannon</a> <a class="post-tag" href="/cours/tags/cama/">CAMA</a> <a class="post-tag" href="/cours/tags/loi/">loi</a> <a class="post-tag" href="/cours/tags/rvau/">RVAU</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/cours/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/cours/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/cours/assets/js/dist/post.min.js"></script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" }, tagSide: "right" }, tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], displayMath: [ ['$$','$$'], ["\\[","\\]"] ], processEscapes: true }, CommonHTML: { linebreaks: { automatic: true } }, "HTML-CSS": { linebreaks: { automatic: true } }, SVG: { linebreaks: { automatic: true } } }); MathJax.Hub.Register.StartupHook("TeX AMSmath Ready", function () { MathJax.InputJax.TeX.Stack.Item.AMSarray.Augment({ clearTag() { if (!this.global.notags) { this.super(arguments).clearTag.call(this); } } }); }); </script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <script type="text/javascript" charset="utf-8" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS_CHTML"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/cours/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-PVWXSNG5J8"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-PVWXSNG5J8'); }); </script>
