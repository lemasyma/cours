<!DOCTYPE html><html lang="fr-FR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="pv-proxy-endpoint" content="https://cours-v2.ew.r.appspot.com/query?id=agplfmNvdXJzLXYychULEghBcGlRdWVyeRiAgIDo14eBCgw"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="IMED2: TP3" /><meta property="og:locale" content="fr_FR" /><meta name="description" content="Reconstruction tomographique (2/3)" /><meta property="og:description" content="Reconstruction tomographique (2/3)" /><link rel="canonical" href="https://lemasyma.github.io/cours/posts/imed2_tp3/" /><meta property="og:url" content="https://lemasyma.github.io/cours/posts/imed2_tp3/" /><meta property="og:site_name" content="Cours" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-25T09:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="IMED2: TP3" /><meta name="google-site-verification" content="mErcVOJcxNzULHvQ99qSclI_DTX0zANqgpsd3jGhkfs" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-12T22:38:36+01:00","datePublished":"2021-11-25T09:00:00+01:00","description":"Reconstruction tomographique (2/3)","headline":"IMED2: TP3","mainEntityOfPage":{"@type":"WebPage","@id":"https://lemasyma.github.io/cours/posts/imed2_tp3/"},"url":"https://lemasyma.github.io/cours/posts/imed2_tp3/"}</script><title>IMED2: TP3 | Cours</title><link rel="apple-touch-icon" sizes="180x180" href="/cours/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/cours/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/cours/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/cours/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/cours/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Cours"><meta name="application-name" content="Cours"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/cours/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cours-v2.ew.r.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://cours-v2.ew.r.appspot.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/cours/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/cours/" alt="avatar" class="mx-auto"> <img src="/cours/assets/img/favicons/logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/cours/">Cours</a></div><div class="site-subtitle font-italic">Certains cours sont en francais, certains sont en anglais, d'autres sont un mix des deux</div></div><ul class="w-100"><li class="nav-item"> <a href="/cours/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/cours/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/cours/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/cours/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/cours/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/lemasyma" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="" aria-label="" target="_blank" rel="noopener"> <i class=""></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/cours/"> Home </a> </span> <span>IMED2: TP3</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>IMED2: TP3</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/lemasyma">lemasyma</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2021-11-25 09:00:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Thu, Nov 25, 2021, 9:00 AM +0100" >Nov 25, 2021</em> </span> <span> Updated <em class="timeago" date="2022-02-12 22:38:36 +0100 " data-toggle="tooltip" data-placement="bottom" title="Sat, Feb 12, 2022, 10:38 PM +0100" >Feb 12</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2404 words"> <em>13 min</em> read</span> <span> <em id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </em> views </span></div></div></div><div class="post-content"><h1 id="reconstruction-tomographique-23">Reconstruction tomographique (2/3)</h1><p>Vous avez tous les outils pour comprendre la reconstruction tomographique 2D en géométrie parallèle dans le cadre idéal : à partir des lignes intégrales (transformée de Radon), il est possible via le théorème coupe-projection de récupérer l’objet correspondant aux projections (rétroprojection filtrée). Cette théorie est bien jolie, mais… la réalité est assez différente ! Le but de ce Notebook est de vous familiariser avec un certain nombre de non-idéalités des systèmes tomographiques, et d’identifier les effets de ces non-idéalités dans les images reconstruites. Nous passerons en revue :</p><ul><li>Une non-idéalité du tube : son caractère intrinsèquement polychromatique<li>Une non-idéalité du détecteur : la présence de gains et d’offsets (cela doit vous dire quelque chose !)<li>Une non-idéalité liée aux interactions photon/matière : le diffusé</ul><p>Mais il existe de nombreuses autres sources de non-idéalités, par exemple une non-idéalité liée à l’objet lui-même (ou au patient) : la présence de mouvement au cours de l’acquisition (avez-vous des exemples en tête ?)</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">skimage.draw</span> <span class="kn">import</span> <span class="n">circle</span><span class="p">,</span> <span class="n">disk</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="kn">import</span> <span class="n">radon</span><span class="p">,</span> <span class="n">iradon</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="n">mpl</span>
<span class="n">mpl</span><span class="p">.</span><span class="n">rc</span><span class="p">(</span><span class="s">'image'</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'gray'</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">'none'</span><span class="p">)</span>
</pre></table></code></div></div><h1 id="partie-1---durcissement-de-faisceau">Partie 1 - Durcissement de faisceau</h1><p>On se donne un vecteur d’angles <code class="language-plaintext highlighter-rouge">theta</code>. Puis, on construit deux images via la fonction <code class="language-plaintext highlighter-rouge">buildImage</code>. Cette fonction prend en entrée une énergie en keV, et génère une image constituée d’os, de matière molle du cerveau, et d’iode (cas d’une imagerie vasculaire avec injection de produit de contraste). Les coefficients d’atténuation dépendant de l’énergie considérée, nous pouvons avoir deux images différentes selon que l’on se place à 80 keV ou à 100 keV. Vous remarquerez que j’ai aussi ajouté un facteur de dilution de l’iode : c’est que l’on n’injecte pas toujours de l’iode pure dans le corps du patient !</p><p>Lancez les deux cellules suivantes.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">N</span> <span class="o">=</span> <span class="mi">360</span>
<span class="n">theta_min</span> <span class="o">=</span> <span class="mf">0.</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span>
<span class="n">theta_max</span> <span class="o">=</span> <span class="mf">180.0</span><span class="o">+</span><span class="n">theta_min</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">theta_min</span><span class="p">,</span> <span class="n">theta_max</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="c1"># in g/cm3
</span><span class="n">dilution</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">densities</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Brain'</span><span class="p">:</span><span class="mf">1.043</span><span class="p">,</span>
             <span class="s">'Bone'</span><span class="p">:</span> <span class="mf">1.8</span><span class="p">,</span>
             <span class="s">'Iodine'</span><span class="p">:</span> <span class="mf">4.93</span><span class="o">*</span><span class="n">dilution</span>
            <span class="p">}</span>
<span class="n">massAttenuationCoefficient</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Brain'</span><span class="p">:</span>  <span class="p">{</span><span class="mi">80</span><span class="p">:</span> <span class="mf">1.831e-1</span><span class="p">,</span>
                                        <span class="mi">100</span><span class="p">:</span> <span class="mf">1.701e-1</span><span class="p">},</span>
                              <span class="s">'Bone'</span><span class="p">:</span>   <span class="p">{</span><span class="mi">80</span><span class="p">:</span> <span class="mf">2.229e-1</span><span class="p">,</span>
                                        <span class="mi">100</span><span class="p">:</span> <span class="mf">1.855e-1</span><span class="p">},</span>
                              <span class="s">'Iodine'</span><span class="p">:</span> <span class="p">{</span><span class="mi">80</span><span class="p">:</span> <span class="mf">3.51</span><span class="p">,</span>
                                        <span class="mi">100</span><span class="p">:</span> <span class="mf">1.942</span><span class="p">}</span>
                             <span class="p">}</span>
<span class="k">def</span> <span class="nf">buildImage</span><span class="p">(</span><span class="n">kev</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
    <span class="n">rr</span><span class="p">,</span> <span class="n">cc</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(((</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.45</span><span class="p">)</span>
    <span class="n">img</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="n">massAttenuationCoefficient</span><span class="p">[</span><span class="s">'Bone'</span><span class="p">][</span><span class="n">kev</span><span class="p">]</span><span class="o">*</span><span class="n">densities</span><span class="p">[</span><span class="s">'Bone'</span><span class="p">]</span>
    <span class="n">rr</span><span class="p">,</span> <span class="n">cc</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(((</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">img</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="n">massAttenuationCoefficient</span><span class="p">[</span><span class="s">'Brain'</span><span class="p">][</span><span class="n">kev</span><span class="p">]</span><span class="o">*</span><span class="n">densities</span><span class="p">[</span><span class="s">'Brain'</span><span class="p">]</span>
    <span class="n">rr</span><span class="p">,</span> <span class="n">cc</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(((</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span><span class="p">,(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">img</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="n">massAttenuationCoefficient</span><span class="p">[</span><span class="s">'Iodine'</span><span class="p">][</span><span class="n">kev</span><span class="p">]</span><span class="o">*</span><span class="n">densities</span><span class="p">[</span><span class="s">'Iodine'</span><span class="p">]</span>
    <span class="n">rr</span><span class="p">,</span> <span class="n">cc</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(((</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.65</span><span class="p">,(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.7</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">img</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="n">massAttenuationCoefficient</span><span class="p">[</span><span class="s">'Iodine'</span><span class="p">][</span><span class="n">kev</span><span class="p">]</span><span class="o">*</span><span class="n">densities</span><span class="p">[</span><span class="s">'Iodine'</span><span class="p">]</span>
    <span class="n">rr</span><span class="p">,</span> <span class="n">cc</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(((</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.65</span><span class="p">,(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.3</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">img</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="n">massAttenuationCoefficient</span><span class="p">[</span><span class="s">'Iodine'</span><span class="p">][</span><span class="n">kev</span><span class="p">]</span><span class="o">*</span><span class="n">densities</span><span class="p">[</span><span class="s">'Iodine'</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">img</span>

<span class="n">img</span> <span class="o">=</span> <span class="p">{</span><span class="mi">80</span><span class="p">:</span><span class="n">buildImage</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span> <span class="mi">100</span><span class="p">:</span><span class="n">buildImage</span><span class="p">(</span><span class="mi">100</span><span class="p">)}</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'80 keV'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'100 keV'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_4_0.png" alt="png" /></p><p>Nous allons générer les sinogrammes correspondant à ces deux images. Si ASTRA est une très bonne toolbox pour vous amuser à générer différentes géométries d’acquisition, utiliser des algorithmes de reconstruction itérative, etc., il existe également une fonction standard de scikit-image pour la géométrie parallèle 2D : <code class="language-plaintext highlighter-rouge">radon</code> pour la projection, et <code class="language-plaintext highlighter-rouge">iradon</code> pour la reconstruction. On écrira, pour projeter une image selon un vecteur d’angles <code class="language-plaintext highlighter-rouge">theta</code> :</p><p><code class="language-plaintext highlighter-rouge">radon(img, theta=theta, circle=True, preserve_range=True)</code></p><p>De même, pour reconstruire l’image à partir de son sinogramme, on écrira :</p><p><code class="language-plaintext highlighter-rouge">iradon(sino, theta=theta, circle=True)</code></p><h3 id="questions">Questions<a href="#questions"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>Générez les sinogrammes des deux images ci-dessus.<li>Reconstruisez les images issues de ces sinogrammes.</ol><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1"># Question 1
# Sauvez les sinogrammes dans un dictionnaire :
# p = {80: **sinogramme à 80 keV** ; 100: **sinogramme à 100 keV**}
</span><span class="n">p</span> <span class="o">=</span> <span class="p">{</span><span class="mi">80</span><span class="p">:</span><span class="n">radon</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">circle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="mi">100</span><span class="p">:</span><span class="n">radon</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">circle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="bp">True</span><span class="p">)}</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">im0</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">80</span><span class="p">].</span><span class="n">T</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im0</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'auto'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'80 keV'</span><span class="p">)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">100</span><span class="p">].</span><span class="n">T</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'auto'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'100 keV'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_6_0.png" alt="png" /></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1"># Question 2
# Sauvez les reconstructions dans un dictionnaire :
# mono = {80: **reconstruction à 80 keV** ; 100: **reconstruction à 100 keV**}
</span><span class="n">mono</span> <span class="o">=</span> <span class="p">{</span><span class="mi">80</span><span class="p">:</span><span class="n">iradon</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">circle</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="mi">100</span><span class="p">:</span><span class="n">iradon</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">circle</span><span class="o">=</span><span class="bp">True</span><span class="p">)}</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">mono</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'80 keV'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">mono</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'100 keV'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_7_0.png" alt="png" /></p><p>Le modèle de Beer-Lambert polychromatique empêche la possibilité de récupérer la partie linéaire, puisque : \(I = \int_{\mathrm{spectre}} I_0(E)e^{-p(E)}dE.\) En supposant (c’est encore une nouvelle simplification, mais elle suffira à illustrer le problème) que le spectre est constitué uniquement de deux énergies $E_0$ et $E_1$, l’intensité reçue est donc $I=I_0(E_0)e^{-p(E_0)}+I_0(E_1)e^{-p(E_1)}$, qu’on peut réécrire de la façon suivante : \(I = I_0\left(a\times e^{-p(E_0)}+(1-a)\times e^{-p(E_1)}\right)\) avec $a\in[0,1]$. Si on utilise la transformation $I\mapsto \log(I_0)-\log(I)$, comme on le fait en monochromatique, on obtient ici une projection $p_E$ égale à \(p_E = \log(I_0)-\log\left(a\times e^{-p(E_0)}+(1-a)\times e^{-p(E_1)}\right).\)</p><p>On se propose de simuler une acquisition polychromatique, c’est-à-dire, une acquisition issue d’un faisceau de rayons X distribué sur plusieurs énergies. Le plus simple est de considérer une approximation bichromatique du faisceau. Dans ce contexte, on considère que les photons X incidents sont de deux énergies, à savoir 80 keV et 100 keV. La probabilité que le photon incident soit à 80 keV est donnée par $P(80) = a_{80}$, et celle d’avoir un photon incident à 100 keV est $P(100)=1-P(80)$.</p><h3 id="questions-1">Questions<a href="#questions-1"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>Avec une telle distribution de probabilité, et les sinogrammes précédemment calculés à 80 keV et 100 keV, quelle est l’intensité reçue au détecteur ?<li>Calculez la projection $p_E$ dans la fonction <code class="language-plaintext highlighter-rouge">bichromatic</code> (on suppose $I_0=1$) ; attention : les sinogrammes que vous avez calculés sont en unités “pixels” ; il faut se remettre en centimètres pour prendre des exponentielles qui aient un sens.<li>Reconstruisez l’image à partir de ce sinogramme : qu’observez-vous ?</ol><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1"># Question 4
</span><span class="k">def</span> <span class="nf">bichromatic</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a80</span><span class="o">=</span><span class="mf">0.66</span><span class="p">):</span>
    <span class="n">pixel2cm</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">a80</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">pixel2cm</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="mi">80</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a80</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">pixel2cm</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="mi">100</span><span class="p">]))</span><span class="o">/</span><span class="n">pixel2cm</span>

<span class="n">a80</span> <span class="o">=</span> <span class="mf">0.66</span>
<span class="n">sinogram</span> <span class="o">=</span> <span class="n">bichromatic</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a80</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">80</span><span class="p">].</span><span class="n">T</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'auto'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'80 keV'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">100</span><span class="p">].</span><span class="n">T</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'auto'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'100 keV'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">sinogram</span><span class="p">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'auto'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Bichromatic'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_9_0.png" alt="png" /></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1"># Question 5
</span><span class="n">out</span> <span class="o">=</span> <span class="n">iradon</span><span class="p">(</span><span class="n">sinogram</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">circle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;matplotlib.colorbar.Colorbar at 0x7fce5a3361f0&gt;
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_10_1.png" alt="png" /></p><p>On se propose de comprendre l’origine de ces artefacts (dits de durcissement de faisceau).</p><h3 id="questions-2">Questions<a href="#questions-2"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>Générez un vecteur d’épaisseurs en cm, variant de zéro à 45 cm (choisissez $n=500$ échantillons). Pour chaque épaisseur testée $T$, calculez $T\times \mu_{\mathrm{iodine}}(\mathrm{keV})$ pour 80 keV et 100 keV.<li>Utilisez la fonction <code class="language-plaintext highlighter-rouge">bichromatic</code> pour calculer la projection bichromatique de $T\mu_{\mathrm{iodine}}$, et tracez ce vecteur en fonction du vecteur correspondant à une acquisition monochromatique à 80 keV. Qu’observez-vous ? Pouvez-vous relier cette observation aux artefacts de l’image ci-dessus ?<li>On veut “recaler” les mesures bichromatiques à leurs mesures “idéales” monochromatiques à 80 keV. Utilisez la fonction <code class="language-plaintext highlighter-rouge">np.polyfit</code> à l’ordre 3 pour obtenir un fit polynomial.</ol><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1"># Question 6
# Sauvez les T*µ dans un dictionnaire comme fait avec les sinogrammes et reconstructions précédentes
</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">iodineProjection</span> <span class="o">=</span> <span class="p">{</span><span class="n">kev</span> <span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">densities</span><span class="p">[</span><span class="s">'Iodine'</span><span class="p">]</span> <span class="k">for</span> <span class="n">kev</span><span class="p">,</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">massAttenuationCoefficient</span><span class="p">[</span><span class="s">'Iodine'</span><span class="p">].</span><span class="n">items</span><span class="p">()}</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1"># Question 7
# y est la projection bichromatique
# x0 est la projection monochromatique
</span><span class="n">y</span> <span class="o">=</span> <span class="n">bichromatic</span><span class="p">(</span><span class="n">iodineProjection</span><span class="p">,</span> <span class="n">a80</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">iodineProjection</span><span class="p">[</span><span class="mi">80</span><span class="p">]</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'Mono vs Bichro'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">iodineProjection</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">'Mono vs Ideal'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Monochromatic'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Bichromatic'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_13_0.png" alt="png" /></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1"># Question 8
</span><span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">polynomial</span><span class="p">.</span><span class="n">polynomial</span><span class="p">.</span><span class="n">Polynomial</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">polynomial</span> <span class="o">=</span> <span class="n">params</span>
<span class="k">print</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>88.09429686309687 + 103.43751237094426·x¹ + 9.090711918937586·x² -
6.380448144804321·x³
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">polynomial</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>[&lt;matplotlib.lines.Line2D at 0x7fce5a115970&gt;]
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_15_1.png" alt="png" /></p><p>On se propose d’utiliser ce fit polynomial pour corriger l’image. Pour cela, et en première approximation, nous allons supposer que les artefacts observés viennent uniquement des inserts d’iode. Ceux-ci sont reconstruits correctement, avec peut-être une valeur à l’intérieur de l’insert légèrement différente de la vraie valeur, mais en tout cas, ces inserts sont identifiables. Ils sont aussi beaucoup plus intenses que les autres structures de l’image reconstruite.</p><h3 id="questions-3">Questions<a href="#questions-3"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>Trouvez manuellement un seuil qui vous permette d’isoler les inserts d’iode dans l’image reconstruite.<li>Projetez les valeurs de ces inserts d’iode ; transformez le sinogramme obtenu en utilisant le polynôme trouvé précédemment.<li>Reconstruisez une image à partir de ce sinogramme transformé.<li>Lancez la boucle d’images suivante : qu’observez-vous ?</ol><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1"># Question 9
</span><span class="n">seg</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">seg</span><span class="p">[</span><span class="n">seg</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;matplotlib.image.AxesImage at 0x7fce5a606820&gt;
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_17_1.png" alt="png" /></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1"># Question 10
</span><span class="n">segProj</span> <span class="o">=</span> <span class="n">radon</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">circle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">segProj</span><span class="p">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">tmp</span> <span class="o">=</span> <span class="n">polynomial</span><span class="p">(</span><span class="n">segProj</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">T</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_18_0.png" alt="png" /></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;matplotlib.image.AxesImage at 0x7fce5a5df2b0&gt;
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_18_2.png" alt="png" /></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1"># Question 11
</span><span class="n">reproj</span> <span class="o">=</span> <span class="n">iradon</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">circle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">reproj</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;matplotlib.colorbar.Colorbar at 0x7fce5a02cd00&gt;
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_19_1.png" alt="png" /></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1"># Question 12
</span><span class="n">search</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
<span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">search</span><span class="p">:</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">out</span><span class="o">+</span><span class="n">alpha</span><span class="o">*</span><span class="n">reproj</span>
    <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">80</span><span class="p">]</span><span class="o">-</span><span class="n">rec</span><span class="p">)</span>
    <span class="n">f</span><span class="p">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Difference from ground truth'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_20_0.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_20_1.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_20_2.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_20_3.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_20_4.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_20_5.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_20_6.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_20_7.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_20_8.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_20_9.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_20_10.png" alt="png" /></p><h1 id="partie-2---non-idéalités-du-détecteur">Partie 2 - Non-idéalités du détecteur</h1><p>Un détecteur présente plusieurs non idéalités ; en premier lieu, il présente des dérives en gains et en offsets. Cela signifie que la mesure faite au niveau d’une cellule du détecteur (un pixel d’un détecteur plan, ou un bin d’un détecteur linéaire), au lieu de mesurer l’intensité $I$ des photons X qui arrivent à la cellule, on mesure \(I_c = \alpha I + \beta.\) $\alpha$ est un gain (proche de 1 généralement), et $\beta$ est un offset. Si on ne fait pas attention à $\alpha$ et $\beta$, on se retrouve avec une projection corrompue $p_c = \log(I_0)-\log(I_c)$.</p><p>Chargez l’image ci-dessous, et regardez son sinogramme :</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-5</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">fromfile</span><span class="p">(</span><span class="s">'CTscan.raw'</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">'float32'</span><span class="p">).</span><span class="n">reshape</span><span class="p">((</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">))</span><span class="o">*</span><span class="n">scale</span>
<span class="n">ctDisplay</span> <span class="o">=</span> <span class="p">{</span><span class="s">'vmin'</span><span class="p">:</span><span class="mi">950</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span><span class="s">'vmax'</span><span class="p">:</span><span class="mi">1150</span><span class="o">*</span><span class="n">scale</span><span class="p">}</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="o">**</span><span class="n">ctDisplay</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;matplotlib.colorbar.Colorbar at 0x7fce56e10fd0&gt;
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_22_1.png" alt="png" /></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">sinogram0</span> <span class="o">=</span> <span class="n">radon</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">circle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1">#sinogram0[100] = (sinogram0[99] + sinogram0[101]) / 2
#sinogram0[100] *= 0.9
</span><span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sinogram0</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'auto'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;matplotlib.colorbar.Colorbar at 0x7fce56d6cd60&gt;
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_23_1.png" alt="png" /></p><p>Reconstruisez l’image à partir de ce sinogramme :</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">img_</span> <span class="o">=</span> <span class="n">iradon</span><span class="p">(</span><span class="n">sinogram0</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">circle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_</span><span class="p">,</span><span class="o">**</span><span class="n">ctDisplay</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;matplotlib.colorbar.Colorbar at 0x7fce56ca4b80&gt;
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_25_1.png" alt="png" /></p><h3 id="questions-4">Questions<a href="#questions-4"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>Partant du détecteur utilisé pour le sinogramme précédent (de taille <code class="language-plaintext highlighter-rouge">sinogram.shape[0]</code>), générer un vecteur de gains égaux à 1 et un vecteur d’offsets égaux à 0 (cas idéal). Corrompez le vecteur de gain tous les <code class="language-plaintext highlighter-rouge">n</code> bins par un bruit d’écart-type de 1%. Affichez le vecteur des gains. Générez le sinogramme qui aurait été obtenu si la mesure avait subi ces gains à chaque acquisition. Reconstruisez l’image : qu’observez-vous comme artefacts ?<li>Corrompez le vecteur d’offsets tous les <code class="language-plaintext highlighter-rouge">n</code> bins (en partant de <code class="language-plaintext highlighter-rouge">n//2</code> cette fois) par un bruit d’écart-type de 1%. Affichez le vecteur des offsets. Générez le sinogramme qui aurait été obtenu si la mesure avait subi ces gains et ces offsets à chaque acquisition. Reconstruisez l’image : qu’observez-vous comme artefacts ? (Fixez <code class="language-plaintext highlighter-rouge">I0=10</code>)<li>Changez la valeur de <code class="language-plaintext highlighter-rouge">I0</code> à 100, 1000, 10000 : qu’observez-vous ? Quels artefacts disparaissent / se maintiennent ? Pourquoi ?</ol><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="n">sinogram</span> <span class="o">=</span> <span class="n">sinogram0</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">sinogram</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">5</span>
<span class="c1"># Question 1
# Vecteur de gains
</span><span class="n">gain</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sinogram</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">gain</span><span class="p">[::</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.01</span>

<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Question 2
# Vecteur d'offsets
</span><span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sinogram</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">offset</span><span class="p">[::</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.1</span>

<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">I0</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># Génération du sinogramme corrompu en gains / en offsets / les deux
</span><span class="n">sinogram</span> <span class="o">=</span> <span class="n">gain</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sinogram</span> <span class="o">+</span> <span class="n">offset</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sinogram</span><span class="p">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Reconstruction
</span><span class="n">out</span> <span class="o">=</span> <span class="n">iradon</span><span class="p">(</span><span class="n">sinogram</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">circle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="o">**</span><span class="n">ctDisplay</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="o">**</span><span class="n">ctDisplay</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>

</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_27_0.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_27_1.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_27_2.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_27_3.png" alt="png" /></p><h1 id="partie-3---interactions-avec-la-matière--rayonnement-diffusé">Partie 3 - Interactions avec la matière : rayonnement diffusé</h1><p>Le rayonnement diffusé est inhérent à la physique des rayons X. Il résulte d’interactions avec la matière (avec le patient, notamment). De deux choses l’une : soit on bloque le rayonnement diffusé avant qu’il n’atteigne le détecteur ; soit on ne le bloque pas, et si on ne corrige pas la mesure par une estimation du diffusé, la qualité image peut s’en trouver réduite.</p><h3 id="questions-5">Questions<a href="#questions-5"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>Si on calcule toujours $p=\log(I_0)-\log(I)$, mais que cette fois-ci $I$ n’est plus égal au primaire $P=I_0 e^{-p}$, mais au primaire plus le diffusé (autrement dit: $I=P+S$), quelle erreur fait-on sur $p$ ? Les lignes intégrales sont-elles sous-estimées ? sur-estimées ?<li>On se propose de simuler un modèle très simple de diffusé ; on suppose que le diffusé ressemble à une versions floutée du rayonnement primaire (celui qui vient directement de la source). Utilisez la fonction <code class="language-plaintext highlighter-rouge">gaussian()</code> de <code class="language-plaintext highlighter-rouge">skimage</code> pour générer une version lissée du rayonnement primaire (on se fiche de <code class="language-plaintext highlighter-rouge">I0</code> ici, qu’on supposera égal à 1). Prenez <code class="language-plaintext highlighter-rouge">sigma=10</code> comme écart-type du lissage. Ajouter 10% de cette image au primaire, et récupérez le sinogramme associé. Reconstruisez l’image : qu’observez-vous ? Et avec 20%, 30% ?<li><p>Calculez le “scatter-to-primary ratio” (ou SPR), égal à $S/P$ ; quelles sont les valeurs de ce ratio ?</p><li>$\hat P = P - log(1 + SPR)$</ol><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">skimage.filters</span> <span class="kn">import</span> <span class="n">gaussian</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1"># Question 2
</span><span class="n">sinogram</span> <span class="o">=</span> <span class="n">sinogram0</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Génération du diffusé
</span><span class="n">sigma</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">qty</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">primary</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">sinogram</span><span class="p">)</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">qty</span> <span class="o">*</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">primary</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>

<span class="c1"># Génération du sinogramme corrompu en diffusé
</span><span class="n">sinogram</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">primary</span> <span class="o">+</span> <span class="n">scatter</span><span class="p">)</span>

<span class="c1"># Reconstruction
</span><span class="n">out</span> <span class="o">=</span> <span class="n">iradon</span><span class="p">(</span><span class="n">sinogram</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">circle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="o">**</span><span class="n">ctDisplay</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="o">**</span><span class="n">ctDisplay</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Question 3
# SPR
</span><span class="n">SPR</span> <span class="o">=</span> <span class="n">scatter</span> <span class="o">/</span> <span class="n">primary</span>

<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">SPR</span><span class="p">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;matplotlib.colorbar.Colorbar at 0x7fce4e72f880&gt;
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_32_1.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_32_2.png" alt="png" /></p><p>La question du diffusé en particulier – et des artefacts en général – est loin d’être anodine ; non seulement la qualité image s’en trouve dégradée, mais pire encore, les applications utilisées en aval (segmentation, recalage, quantification) peuvent voir leurs performances baisser à cause d’une image de mauvaise qualité.</p><h3 id="questions-6">Questions<a href="#questions-6"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>Regardez l’histogramme de l’image CT “propre” ; jouez avec des seuils min et max pour isoler l’hypodensité circulaire dans la tête du patient : y arrivez-vous ? Avez-vous des idées pour nettoyer votre segmentation des pixels segmentés n’appartenant pas à l’hypodensité ?</ol><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1"># Question 4
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">bins</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">img</span><span class="o">&lt;</span><span class="mf">0.0104</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mask</span><span class="p">[</span><span class="n">img</span><span class="o">&lt;</span><span class="mf">0.0101</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="n">mask</span><span class="p">[</span><span class="n">mask</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="o">**</span><span class="n">ctDisplay</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s">'hot'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;matplotlib.image.AxesImage at 0x7fce4e5dddc0&gt;
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_35_1.png" alt="png" /></p><p><img data-proofer-ignore data-src="/cours/assets/img/imed2_tp3/output_35_2.png" alt="png" /></p><h3 id="questions-7">Questions<a href="#questions-7"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>Refaites l’exercice, mais sur l’image reconstruite en présence du diffusé à 30%. Comment est l’histogramme des valeurs comparé au précédent cas ? Est-il aussi simple de segmenter l’hypodensité ?</ol><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1"># Question 5
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">bins</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">out</span><span class="o">&lt;</span><span class="mf">0.0104</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mask</span><span class="p">[</span><span class="n">out</span><span class="o">&lt;</span><span class="mf">0.005</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="n">mask</span><span class="p">[</span><span class="n">mask</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="o">**</span><span class="n">ctDisplay</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s">'jet'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/cours/categories/image-s9/'>Image S9</a>, <a href='/cours/categories/imed2/'>IMED2</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/cours/tags/image/" class="post-tag no-text-decoration" >Image</a> <a href="/cours/tags/s9/" class="post-tag no-text-decoration" >S9</a> <a href="/cours/tags/imed2/" class="post-tag no-text-decoration" >IMED2</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=IMED2: TP3 - Cours&url=https://lemasyma.github.io/cours/posts/imed2_tp3/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=IMED2: TP3 - Cours&u=https://lemasyma.github.io/cours/posts/imed2_tp3/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=IMED2: TP3 - Cours&url=https://lemasyma.github.io/cours/posts/imed2_tp3/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/cours/posts/ocvx_norme/">OCVX: Norme</a><li><a href="/cours/posts/imed2_tp3/">IMED2: TP3</a><li><a href="/cours/posts/prsta_revisions_1/">PRSTA: Revisions 1</a><li><a href="/cours/posts/prsta_td5/">PRSTA: TD 5</a><li><a href="/cours/posts/prsta_td4/">PRSTA: TD 4</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/cours/tags/image/">Image</a> <a class="post-tag" href="/cours/tags/s8/">S8</a> <a class="post-tag" href="/cours/tags/s9/">S9</a> <a class="post-tag" href="/cours/tags/tronc-commun/">tronc commun</a> <a class="post-tag" href="/cours/tags/scia/">SCIA</a> <a class="post-tag" href="/cours/tags/s6/">S6</a> <a class="post-tag" href="/cours/tags/shannon/">Shannon</a> <a class="post-tag" href="/cours/tags/cama/">CAMA</a> <a class="post-tag" href="/cours/tags/loi/">loi</a> <a class="post-tag" href="/cours/tags/rvau/">RVAU</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/cours/posts/imed2_project/"><div class="card-body"> <em class="timeago small" date="2021-11-25 11:00:00 +0100" >Nov 25, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>IMED2: Project</h3><div class="text-muted small"><p> Lien de la note Hackmd Part 1 Retinal fundus image segmentation Iterative Closest Point - ICP Quand on itere, on reste bloques sur des minimums local En remplacant points par courbes: On...</p></div></div></a></div><div class="card"> <a href="/cours/posts/imed2_registration_3D/"><div class="card-body"> <em class="timeago small" date="2021-11-26 09:00:00 +0100" >Nov 26, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>IMED2: 3D/3D registration with labeled atlas</h3><div class="text-muted small"><p> DPH and TURP treatment The endo-vascular treatment for BPH C’est quoi le challenge ? La prostate a BEAUCOUP de variantes anatomiques La variante anatomique la moins embetante est la C...</p></div></div></a></div><div class="card"> <a href="/cours/posts/imed2_introduction/"><div class="card-body"> <em class="timeago small" date="2021-10-13 16:00:00 +0200" >Oct 13, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>IMED2: Introduction</h3><div class="text-muted small"><p> Agenda Introduction to Medical Imaging What is medical imaging ? Roles, Players, Modalities Anatomical vs Functional Imaging Ionizing vs Non-ionizing Radiation ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/cours/posts/imed2_registration/" class="btn btn-outline-primary" prompt="Older"><p>IMED2: Registration in medical imaging</p></a> <a href="/cours/posts/imed2_project/" class="btn btn-outline-primary" prompt="Newer"><p>IMED2: Project</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/lemasyma">lemasyma</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/cours/tags/image/">Image</a> <a class="post-tag" href="/cours/tags/s8/">S8</a> <a class="post-tag" href="/cours/tags/s9/">S9</a> <a class="post-tag" href="/cours/tags/tronc-commun/">tronc commun</a> <a class="post-tag" href="/cours/tags/scia/">SCIA</a> <a class="post-tag" href="/cours/tags/s6/">S6</a> <a class="post-tag" href="/cours/tags/shannon/">Shannon</a> <a class="post-tag" href="/cours/tags/cama/">CAMA</a> <a class="post-tag" href="/cours/tags/loi/">loi</a> <a class="post-tag" href="/cours/tags/rvau/">RVAU</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/cours/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/cours/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/cours/assets/js/dist/post.min.js"></script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" }, tagSide: "right" }, tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], displayMath: [ ['$$','$$'], ["\\[","\\]"] ], processEscapes: true }, CommonHTML: { linebreaks: { automatic: true } }, "HTML-CSS": { linebreaks: { automatic: true } }, SVG: { linebreaks: { automatic: true } } }); MathJax.Hub.Register.StartupHook("TeX AMSmath Ready", function () { MathJax.InputJax.TeX.Stack.Item.AMSarray.Augment({ clearTag() { if (!this.global.notags) { this.super(arguments).clearTag.call(this); } } }); }); </script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <script type="text/javascript" charset="utf-8" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS_CHTML"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/cours/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-PVWXSNG5J8"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-PVWXSNG5J8'); }); </script>
